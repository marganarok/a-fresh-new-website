function initScrollProgress(){let t=document.getElementById("scrollProgress");t&&window.addEventListener("scroll",function(){var e=(document.body.scrollTop||document.documentElement.scrollTop)/(document.documentElement.scrollHeight-document.documentElement.clientHeight)*100;t.style.width=e+"%"})}function initSectionReveal(){let e=document.querySelectorAll(".sacred-section");function t(){e.forEach(e=>{e.getBoundingClientRect().top<.85*window.innerHeight&&e.classList.add("revealed")})}t(),window.addEventListener("scroll",t)}function createSacredParticles(){var t=document.getElementById("particleSystem");if(t)for(let e=0;e<21;e++){var i=document.createElement("div");i.classList.add("divine-particle"),i.style.left=100*Math.random()+"%",i.style.animationDelay=8*Math.random()+"s",t.appendChild(i)}}function updateCosmicWeather(){var e,t,i,o,n=document.getElementById("cosmicWeather");n&&(e=(e=["✨ Favorable","🌟 Exceptional","⚡ Challenging","🔮 Mysterious","💫 Transformative"])[((o=new Date).getDate()+31*(o.getMonth()+1))%e.length],t=(t=["⚡ High","🔥 Intense","🌊 Flowing","🌱 Growing","✨ Subtle"])[o.getHours()%t.length],o=(i=["☀️ Clear","🌤️ Partly Cloudy","🌈 Radiant","⛈️ Thunderous","🌙 Reflective"])[o.getMinutes()%i.length],n.innerHTML=`
        <div>Cosmic Alignment: ${e}</div>
        <div>Divine Energy: ${t}</div>
        <div>Spiritual Weather: ${o}</div>
    `)}function activateMandala(e){e.classList.add("activated");let t=document.createElement("div");t.classList.add("mandala-ripple"),e.appendChild(t),setTimeout(()=>{t.remove()},2e3),increaseWisdom(5)}function animateWisdomMeter(){let e=document.getElementById("wisdomFill");e&&setTimeout(()=>{e.style.width="20%",updateWisdomLevel(20)},1e3)}function increaseWisdom(e){var t,i=document.getElementById("wisdomFill");i&&(t=parseInt(i.style.width)||0,t=Math.min(t+e,100),i.style.width=t+"%",updateWisdomLevel(t))}function updateWisdomLevel(t){var i=document.getElementById("wisdomLevel");if(i){let e="Seeker";90<=t?e="Illuminated Master":80<=t?e="Sage":70<=t?e="Seeing the Patterns":60<=t?e="Awakening":50<=t?e="Conscious Practitioner":40<=t?e="Dedicated Student":30<=t?e="Earnest Seeker":20<=t?e="Curious Explorer":10<=t&&(e="Awakening Interest"),i.textContent=`Wisdom Level: ${t}% - "${e}"`}}function initLazyLoading(){let t=new IntersectionObserver((t,e)=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("loaded"),e.unobserve(t.target))})},{rootMargin:"50px"});document.querySelectorAll(".lazy-load").forEach(e=>{t.observe(e)})}document.addEventListener("DOMContentLoaded",function(){initScrollProgress(),initSectionReveal(),createSacredParticles(),updateCosmicWeather(),animateWisdomMeter(),initLazyLoading()});let wisdomProfile={devotion:0,knowledge:0,meditation:0,service:0,ritual:0,relationship:0,integration:0};function updateWisdomProfile(e,t){wisdomProfile.hasOwnProperty(e)&&(wisdomProfile[e]+=t,increaseWisdom(t/2),showFeedback(e.charAt(0).toUpperCase()+e.slice(1)+" path strengthened!"))}function showFeedback(e){let t=document.createElement("div");t.textContent=e,t.style.position="fixed",t.style.bottom="30px",t.style.left="50%",t.style.transform="translateX(-50%)",t.style.background="rgba(0,0,0,0.8)",t.style.color="var(--divine-gold)",t.style.padding="15px 30px",t.style.borderRadius="10px",t.style.zIndex="1000",t.style.transition="all 0.5s ease",document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>{t.remove()},500)},3e3)}function activatePractice(e){var t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.background="rgba(0,0,0,0.9)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="1000",t.style.flexDirection="column";let i="",r=0;r="meditation"===e?(i=`
                <h2 style="color: var(--divine-gold); margin-bottom: 30px;">Sacred Breath Meditation</h2>
                <p style="color: var(--star-white); margin-bottom: 20px; max-width: 600px; text-align: center;">
                    Center yourself and focus on your breath. With each inhale, visualize divine light entering your being.
                    With each exhale, release all that no longer serves you.
                </p>
                <div style="width: 100px; height: 100px; border-radius: 50%; background: var(--divine-gold); margin: 30px auto; animation: breathe 8s infinite ease-in-out;"></div>
                <p style="color: var(--mystic-silver); margin-top: 30px;" id="meditationTimer">Duration: 2:00</p>
            `,120):(i=`
                <h2 style="color: var(--divine-gold); margin-bottom: 30px;">Sacred Practice</h2>
                <p style="color: var(--star-white); margin-bottom: 20px; max-width: 600px; text-align: center;">
                    Enter a state of reverence and presence as you engage with this practice.
                </p>
            `,60),i+=`
        <button class="sacred-button" style="margin-top: 40px;" onclick="this.parentNode.parentNode.remove();">Complete Practice</button>
    `,t.innerHTML=i,document.body.appendChild(t);e=document.createElement("style");if(e.textContent=`
        @keyframes breathe {
            0%, 100% { transform: scale(0.8); opacity: 0.7; }
            50% { transform: scale(1.2); opacity: 1; }
        }
    `,document.head.appendChild(e),0<r&&document.getElementById("meditationTimer")){let i=r,o=document.getElementById("meditationTimer"),n=setInterval(()=>{var e,t;--i<=0?(clearInterval(n),o.textContent="Practice Complete",increaseWisdom(10)):(e=Math.floor(i/60),t=i%60,o.textContent=`Duration: ${e}:`+t.toString().padStart(2,"0"))},1e3)}}function consultOracle(){var t=document.getElementById("oracleInput");if(t&&t.value.trim()){var i=t.value.trim();let e=t.value="";e=i.toLowerCase().includes("purpose")||i.toLowerCase().includes("meaning")?"Your purpose is not something to be discovered, but rather uncovered through presence and alignment with your deepest values. Look to where your joy meets the world's needs.":i.toLowerCase().includes("love")||i.toLowerCase().includes("relationship")?"The quality of your relationships reflects the relationship you have with yourself. Cultivate self-compassion first, and your capacity to love others will naturally expand.":i.toLowerCase().includes("fear")||i.toLowerCase().includes("anxiety")?"Fear arises when you project yourself into an imagined future. Return to the present moment, where fear cannot exist. Breathe deeply and feel your feet on the ground.":i.toLowerCase().includes("meditation")||i.toLowerCase().includes("practice")?"The most powerful practice is the one you actually do consistently. Start small, but with unwavering commitment. Five minutes of daily presence is worth more than occasional hours.":i.toLowerCase().includes("truth")||i.toLowerCase().includes("reality")?"Truth is not merely intellectual, but experiential. To know the truth, you must become it. Look beyond concepts to the direct experience that precedes all words and thoughts.":(t=["The answer you seek is already within you, waiting to be recognized.","Consider that the question itself may contain assumptions worth examining.","Sometimes the wisest response is to embrace the mystery rather than demanding certainty.","What would love do in this situation?","The obstacle is the path. What you're facing is not blocking your journey—it is your journey.","True wisdom lies in knowing that you do not know.","Look to nature for guidance—observe how it navigates change without resistance.","The quality of your attention determines the quality of your experience.","Between stimulus and response lies a space. In that space lies your freedom and power.","What you resist persists. What you embrace transforms."])[Math.floor(Math.random()*t.length)];t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.background="rgba(0,0,0,0.9)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="1000",t.style.flexDirection="column",t.innerHTML=`
        <div style="max-width: 600px; text-align: center; padding: 40px;">
            <h2 style="color: var(--divine-gold); margin-bottom: 20px;">The Oracle Responds</h2>
            <p style="color: var(--mystic-silver); font-style: italic; margin-bottom: 30px;">"${i}"</p>
            <div class="sacred-quote" style="margin-bottom: 30px;">
                <div class="quote-text">${e}</div>
            </div>
            <button class="sacred-button" onclick="this.parentNode.parentNode.remove();">Contemplate</button>
        </div>
    `,document.body.appendChild(t),increaseWisdom(5)}else showFeedback("Please enter a question first.")}function generateWisdomMap(){let e="integration",t=0;for(var[i,o]of Object.entries(wisdomProfile))o>t&&(t=o,e=i);0===t&&(wisdomProfile.knowledge=5,wisdomProfile.devotion=3,wisdomProfile.meditation=4,wisdomProfile.service=2,wisdomProfile.ritual=3,wisdomProfile.relationship=4,wisdomProfile.integration=3,e="knowledge");var n=document.createElement("div");n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.background="rgba(0,0,0,0.9)",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.zIndex="1000",n.innerHTML=`
        <div style="max-width: 800px; text-align: center; padding: 40px;">
            <h2 style="color: var(--divine-gold); margin-bottom: 20px;">Your Wisdom Map</h2>
            <p style="color: var(--mystic-silver); margin-bottom: 30px;">Your dominant path is: <strong style="color: var(--divine-gold);">${e.charAt(0).toUpperCase()+e.slice(1)}</strong></p>
            
            <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin: 30px 0;">
                <div style="text-align: center;">
                    <div style="width: 100px; height: ${Math.max(20,10*wisdomProfile.devotion)}px; background: var(--divine-gold); margin: 0 auto;"></div>
                    <p style="color: var(--mystic-silver); margin-top: 10px;">Devotion</p>
                </div>
                <div style="text-align: center;">
                    <div style="width: 100px; height: ${Math.max(20,10*wisdomProfile.knowledge)}px; background: var(--sacred-purple); margin: 0 auto;"></div>
                    <p style="color: var(--mystic-silver); margin-top: 10px;">Knowledge</p>
                </div>
                <div style="text-align: center;">
                    <div style="width: 100px; height: ${Math.max(20,10*wisdomProfile.meditation)}px; background: var(--celestial-blue); margin: 0 auto;"></div>
                    <p style="color: var(--mystic-silver); margin-top: 10px;">Meditation</p>
                </div>
                <div style="text-align: center;">
                    <div style="width: 100px; height: ${Math.max(20,10*wisdomProfile.service)}px; background: var(--emerald-wisdom); margin: 0 auto;"></div>
                    <p style="color: var(--mystic-silver); margin-top: 10px;">Service</p>
                </div>
                <div style="text-align: center;">
                    <div style="width: 100px; height: ${Math.max(20,10*wisdomProfile.ritual)}px; background: var(--crimson-passion); margin: 0 auto;"></div>
                    <p style="color: var(--mystic-silver); margin-top: 10px;">Ritual</p>
                </div>
                <div style="text-align: center;">
                    <div style="width: 100px; height: ${Math.max(20,10*wisdomProfile.relationship)}px; background: var(--divine-gold); margin: 0 auto;"></div>
                    <p style="color: var(--mystic-silver); margin-top: 10px;">Relationship</p>
                </div>
                <div style="text-align: center;">
                    <div style="width: 100px; height: ${Math.max(20,10*wisdomProfile.integration)}px; background: var(--sacred-purple); margin: 0 auto;"></div>
                    <p style="color: var(--mystic-silver); margin-top: 10px;">Integration</p>
                </div>
            </div>
            
            <div style="margin: 30px 0;">
                <h3 style="color: var(--divine-gold); margin-bottom: 15px;">Recommended Next Steps</h3>
                <p style="color: var(--star-white); margin-bottom: 15px;">Based on your wisdom profile, consider exploring:</p>
                <ul style="color: var(--mystic-silver); text-align: left; max-width: 500px; margin: 0 auto;">
                    <li>Deepen your ${e} practice through daily commitment</li>
                    <li>Balance your development by exploring the ${getLowestPath()} path</li>
                    <li>Connect with others who share your interest in the ${e} path</li>
                    <li>Study the teachings of masters who excel in your dominant path</li>
                </ul>
            </div>
            
            <button class="sacred-button" onclick="this.parentNode.parentNode.remove();">Continue Journey</button>
        </div>
    `,document.body.appendChild(n),increaseWisdom(5)}function getLowestPath(){let e="integration",t=1/0;for(var[i,o]of Object.entries(wisdomProfile))o<t&&(t=o,e=i);return e}function initiateWisdomJourney(){var e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.background="rgba(0,0,0,0.9)",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.zIndex="1000",e.innerHTML=`
        <div style="max-width: 800px; text-align: center; padding: 40px;">
            <h2 style="color: var(--divine-gold); margin-bottom: 20px;">The Inner Sanctuary</h2>
            <p style="color: var(--star-white); margin-bottom: 30px;">You stand at the threshold of deeper wisdom. The journey ahead requires commitment, courage, and curiosity.</p>
            
            <div class="sacred-quote" style="margin: 30px 0;">
                <div class="quote-text">"The cave you fear to enter holds the treasure that you seek."</div>
                <div class="quote-author">— Joseph Campbell</div>
            </div>
            
            <p style="color: var(--mystic-silver); margin-bottom: 30px;">Are you prepared to embark on this sacred journey?</p>
            
            <div style="display: flex; justify-content: center; gap: 20px;">
                <button class="sacred-button" onclick="beginInnerJourney()">I Am Ready</button>
                <button class="sacred-button" style="background: rgba(0,0,0,0.5);" onclick="this.parentNode.parentNode.parentNode.remove();">Not Yet</button>
            </div>
        </div>
    `,document.body.appendChild(e)}function beginInnerJourney(){var e=document.querySelector('div[style*="position: fixed"]');e&&e.remove();let t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.background="rgba(0,0,0,0.95)",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.zIndex="1000",t.innerHTML=`
        <div style="max-width: 800px; text-align: center; padding: 40px;">
            <div style="width: 150px; height: 150px; border-radius: 50%; background: radial-gradient(circle, var(--divine-gold), transparent); margin: 0 auto 40px; animation: pulse 3s infinite ease-in-out;"></div>
            
            <h2 style="color: var(--divine-gold); margin-bottom: 20px;">The Journey Begins</h2>
            <p style="color: var(--star-white); margin-bottom: 30px; line-height: 1.8;">
                Close your eyes and take three deep breaths. With each inhale, feel yourself drawing in divine light.
                With each exhale, release all tension and resistance.
            </p>
            
            <p style="color: var(--star-white); margin-bottom: 30px; line-height: 1.8;" id="journeyText">
                You stand before an ancient doorway carved with sacred symbols...
            </p>
            
            <button class="sacred-button" id="continueJourney">Continue</button>
        </div>
    `,document.body.appendChild(t);e=document.createElement("style");e.textContent=`
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }
    `,document.head.appendChild(e);let i=["You stand before an ancient doorway carved with sacred symbols...","As you step through the doorway, you enter a vast circular chamber illuminated by soft golden light...","In the center of the chamber stands a crystalline pedestal with an open book...","As you approach, the pages begin to glow with symbols that speak directly to your consciousness...","The symbols transform into a message meant specifically for you at this moment in your journey...","You realize that this inner sanctuary has always existed within you, waiting to be discovered...","With this awareness, you feel a profound shift in your perception of yourself and reality...","You understand that you can return to this sacred space whenever you wish to access deeper wisdom...","Carrying this knowing with you, you prepare to return to ordinary awareness, forever changed..."],o=0,n=document.getElementById("journeyText");e=document.getElementById("continueJourney");n&&e&&e.addEventListener("click",()=>{++o<i.length?n.textContent=i[o]:(t.remove(),showFeedback("Inner journey complete. Wisdom increased significantly."),increaseWisdom(20))})}let previewModal,previewTitle,previewText,previewClose;function initBookPreview(){previewModal=document.getElementById("previewModal"),previewTitle=document.getElementById("previewTitle"),previewText=document.getElementById("previewText"),previewClose=document.getElementById("previewClose"),previewModal&&previewTitle&&previewText&&previewClose&&(previewClose.addEventListener("click",closePreview),previewModal.addEventListener("click",e=>{e.target===previewModal&&closePreview()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&previewModal.classList.contains("active")&&closePreview()}),document.querySelectorAll(".preview-button").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),showPreview(t.getAttribute("data-file"),t.getAttribute("data-title"))})}))}function showPreview(e,t){previewModal&&previewTitle&&previewText&&(previewTitle.textContent="Preview: "+t,previewText.innerHTML='<div class="preview-loading">Loading preview...</div>',previewModal.classList.add("active"),loadFilePreview(e))}function closePreview(){previewModal&&previewModal.classList.remove("active")}function loadFilePreview(e){e&&e.toLowerCase().endsWith(".pdf")?previewText.innerHTML=`
            <div class="preview-pdf-notice">
                <div class="pdf-icon">📄</div>
                <h3>PDF Document</h3>
                <p>This is a PDF file that contains rich formatting, images, and complex layouts.</p>
                <p>To experience the full content with proper formatting, please download the file.</p>
                <div class="pdf-benefits">
                    <strong>PDF Benefits:</strong>
                    <ul>
                        <li>Preserves original formatting</li>
                        <li>Includes images and graphics</li>
                        <li>Professional layout</li>
                        <li>Universal compatibility</li>
                    </ul>
                </div>
            </div>
        `:fetch(e).then(e=>{if(e.ok)return e.text();throw new Error("File not found")}).then(e=>{e=2e3<e.length?e.substring(0,2e3)+"\n\n[... Preview truncated. Download to read the complete text ...]":e;previewText.innerHTML=`<pre>${e}</pre>`}).catch(e=>{console.error("Error loading preview:",e),previewText.innerHTML='<div class="preview-error">Unable to load preview. The file may not be available or there was a loading error.</div>'})}function initLibraryEnhancements(){initLibrarySearch(),initLibraryFilters(),initLibraryStats(),initRecentlyViewed(),initFavoriteSystem(),initShareSystem()}function initLibrarySearch(){var e=document.getElementById("librarySearch");e&&e.addEventListener("input",function(){let l=this.value.toLowerCase().trim();document.querySelectorAll(".library-card").forEach(e=>{var t=e.querySelector(".library-card-title"),i=e.querySelector(".library-description"),o=t.getAttribute("data-original")||t.textContent,n=i.getAttribute("data-original")||i.textContent,r=(t.getAttribute("data-original")||(t.setAttribute("data-original",o),i.setAttribute("data-original",n)),o.toLowerCase()),a=n.toLowerCase(),s=e.dataset.category||"",r=r.includes(l)||a.includes(l)||s.includes(l);l&&r?(e.style.display="flex",e.classList.add("fade-in"),t.innerHTML=highlightSearchTerm(o,l),i.innerHTML=highlightSearchTerm(n,l)):l?e.style.display="none":(e.style.display="flex",t.innerHTML=o,i.innerHTML=n)}),updateLibraryStats()})}function highlightSearchTerm(e,t){return t?(t=new RegExp(`(${t})`,"gi"),e.replace(t,'<mark style="background: #ffd700; color: #000000; padding: 2px 4px; border-radius: 3px;">$1</mark>')):e}function initLibraryFilters(){let t=document.querySelectorAll(".filter-btn");t.length&&t.forEach(e=>{e.addEventListener("click",function(){t.forEach(e=>e.classList.remove("active")),this.classList.add("active");let i=this.dataset.filter;document.querySelectorAll(".library-card").forEach(e=>{var t;"all"===i?e.style.display="block":(t=e.dataset.category||"",e.style.display=t===i?"block":"none")}),updateLibraryStats()})})}function initLibraryStats(){updateLibraryStats()}function updateLibraryStats(){var e=document.querySelectorAll('.library-card:not([style*="display: none"])'),t=document.getElementById("totalBooks"),i=document.getElementById("sacredTexts");t&&(t.textContent=e.length),i&&(t=Array.from(e).filter(e=>"sacred"===e.dataset.category).length,i.textContent=t)}function initRecentlyViewed(){loadRecentlyViewed(),document.querySelectorAll(".preview-button").forEach(e=>{e.addEventListener("click",function(){addToRecentlyViewed(this.dataset.title,this.dataset.file)})})}function addToRecentlyViewed(t,e){let i=JSON.parse(localStorage.getItem("sacredLibrary_recentlyViewed")||"[]");(i=i.filter(e=>e.title!==t)).unshift({title:t,file:e,timestamp:Date.now()}),i=i.slice(0,5),localStorage.setItem("sacredLibrary_recentlyViewed",JSON.stringify(i)),loadRecentlyViewed()}function loadRecentlyViewed(){var e=JSON.parse(localStorage.getItem("sacredLibrary_recentlyViewed")||"[]"),t=document.getElementById("recentlyViewed");t&&(0===e.length?t.innerHTML=`
            <div class="recent-item">
                <div class="recent-title">No recent views</div>
                <div class="recent-desc">Start exploring our collection!</div>
            </div>
        `:t.innerHTML=e.map(e=>`
        <div class="recent-item" onclick="showPreview('${e.file}', '${e.title}')">
            <div class="recent-title">${e.title}</div>
            <div class="recent-desc">Click to preview</div>
        </div>
    `).join(""))}function initFavoriteSystem(){loadFavorites(),document.addEventListener("click",function(e){e.target.classList.contains("favorite-btn")&&(e.stopPropagation(),toggleFavorite(e.target.closest(".library-card").querySelector(".library-card-title").textContent,e.target))})}function toggleFavorite(t,e){let i=JSON.parse(localStorage.getItem("sacredLibrary_favorites")||"[]");i.includes(t)?(i=i.filter(e=>e!==t),e.textContent="⭐",e.title="Add to Favorites",e.style.color=""):(i.push(t),e.textContent="⭐",e.title="Remove from Favorites",e.style.color="#FFD700"),localStorage.setItem("sacredLibrary_favorites",JSON.stringify(i))}function loadFavorites(){let i=JSON.parse(localStorage.getItem("sacredLibrary_favorites")||"[]");document.querySelectorAll(".favorite-btn").forEach(e=>{var t=e.closest(".library-card").querySelector(".library-card-title").textContent;i.includes(t)?(e.textContent="⭐",e.style.color="#FFD700",e.title="Remove from Favorites"):(e.textContent="⭐",e.style.color="",e.title="Add to Favorites")})}function initShareSystem(){document.addEventListener("click",function(e){e.target.classList.contains("share-btn")&&(e.stopPropagation(),shareBook(e.target.closest(".library-card").querySelector(".library-card-title").textContent,window.location.href))})}function shareBook(e,t){let i=`Check out "${e}" from The Sacred Codex Universe Library: `+t;navigator.share?navigator.share({title:e,text:i,url:t}):navigator.clipboard.writeText(i).then(()=>{showNotification("Book link copied to clipboard!")}).catch(()=>{alert("Share this link: "+i)})}function showNotification(e){let t=document.createElement("div");t.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--divine-gold, #FFD700);
        color: #000;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        font-family: 'Crimson Text', serif;
        font-weight: bold;
        z-index: 10000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease;
    `,t.textContent=e;e=document.createElement("style");e.textContent=`
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    `,document.head.appendChild(e),document.body.appendChild(t),setTimeout(()=>{t.style.animation="slideOut 0.3s ease",setTimeout(()=>t.remove(),300)},3e3),e.textContent+=`
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    `}function initEnhancedLibraryFeatures(){var e;document.addEventListener("keydown",e=>{var t;"Escape"===e.key&&(t=document.getElementById("previewModal"))&&t.classList.contains("active")&&t.classList.remove("active"),(e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),t=document.getElementById("librarySearch"))&&(t.focus(),t.select())}),document.querySelectorAll(".download-button").forEach(i=>{i.addEventListener("click",e=>{var t=i.getBoundingClientRect();let r=t.left+t.width/2,a=t.top+t.height/2;for(let n=0;n<12;n++)setTimeout(()=>{let e=document.createElement("div");e.className="divine-particle",e.style.position="fixed",e.style.left=r+"px",e.style.top=a+"px",e.style.width="3px",e.style.height="3px",e.style.background="#ffd700",e.style.zIndex="9999",e.style.pointerEvents="none",e.style.borderRadius="50%";var t=n/12*Math.PI*2,i=100+50*Math.random(),o=r+Math.cos(t)*i,t=a+Math.sin(t)*i;e.style.animation="burstParticle 1s ease-out forwards",e.style.setProperty("--endX",o+"px"),e.style.setProperty("--endY",t+"px"),document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},1e3)},50*n)})}),document.getElementById("burstAnimationStyle")||((e=document.createElement("style")).id="burstAnimationStyle",e.textContent=`
            @keyframes burstParticle {
                0% {
                    transform: translate(0, 0) scale(1);
                    opacity: 1;
                }
                100% {
                    transform: translate(calc(var(--endX) - 50vw), calc(var(--endY) - 50vh)) scale(0);
                    opacity: 0;
                }
            }
        `,document.head.appendChild(e))}function initWisdomPortal(){initWisdomAssessment(),initMandalaActivation(),initWisdomMap(),initInnerSanctuary()}function initWisdomAssessment(){var e=document.querySelectorAll(".option-radio"),t=document.querySelector(".wisdom-level");if(e.length&&t){let t;e.forEach(e=>{e.addEventListener("change",function(){t=calculateWisdomScore(),updateWisdomLevel(t,3)})}),updateWisdomLevel(0,3)}}function calculateWisdomScore(){let t=0;return["q1","q2","q3"].forEach(e=>{var e=document.querySelector(`input[name="${e}"]:checked`);e&&(e=Array.from(e.closest(".option-list").querySelectorAll("li")).indexOf(e.closest("li")),t+=e+1)}),t}function updateWisdomLevel(t,i){var o=document.querySelector(".wisdom-level");if(o){t=Math.round(t/i*100)||0;let e="Seeker";80<=t?e="Sage":60<=t?e="Guide":40<=t?e="Student":20<=t&&(e="Initiate"),o.innerHTML=`
        <div>Wisdom Level: ${t}%</div>
        <div>"${e}"</div>
    `}}function initMandalaActivation(){}function activateMandala(e){e.classList.add("activated");let t=e.querySelectorAll(".mandala-ring");t.forEach((e,t)=>{e.style.animationDuration=10+5*t+"s",e.style.borderColor="#FFD700"}),showWisdomMessage("Mandala activated! Divine energies aligned.","success"),setTimeout(()=>{e.classList.remove("activated"),t.forEach(e=>{e.style.borderColor=""})},3e3)}function initWisdomMap(){var e=document.querySelector(".sacred-card button");e&&e.addEventListener("click",generateWisdomMap)}function generateWisdomMap(){let i=calculateWisdomScore();var e=document.createElement("div"),t=(e.className="wisdom-map-result",e.innerHTML=`
        <h3>Your Personal Wisdom Map</h3>
        <div class="wisdom-paths">
            ${[{name:"Intellectual Wisdom",icon:"🧠",description:"Understanding profound truths"},{name:"Emotional Wisdom",icon:"❤️",description:"Deep connection with others"},{name:"Spiritual Wisdom",icon:"🙏",description:"Divine connection and guidance"},{name:"Practical Wisdom",icon:"🔧",description:"Applying knowledge effectively"},{name:"Creative Wisdom",icon:"🎨",description:"Innovation and inspiration"},{name:"Ethical Wisdom",icon:"⚖️",description:"Moral understanding and justice"},{name:"Intuitive Wisdom",icon:"🔮",description:"Inner knowing and insight"}].map((e,t)=>`
                <div class="wisdom-path ${t<i?"active":""}">
                    <div class="path-icon">${e.icon}</div>
                    <div class="path-content">
                        <h4>${e.name}</h4>
                        <p>${e.description}</p>
                    </div>
                </div>
            `).join("")}
        </div>
        <p class="map-insight">Your wisdom journey shows ${i} activated paths. Continue exploring to unlock your full potential.</p>
    `,document.querySelector(".sacred-card"));t.querySelector("button").style.display="none",t.appendChild(e),showWisdomMessage("Your personal wisdom map has been generated!","success")}function initInnerSanctuary(){var e=document.querySelector(".journey-button");e&&e.addEventListener("click",startInnerJourney)}function startInnerJourney(){let e=document.createElement("div"),t=(e.className="journey-modal",e.innerHTML=`
        <div class="journey-content">
            <h2>The Inner Sanctuary</h2>
            <div class="journey-stage" id="journeyStage">
                <p>Welcome to your inner sanctuary. Take a deep breath and center yourself.</p>
                <p>Feel the divine presence surrounding you...</p>
            </div>
            <div class="journey-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <button class="journey-continue" id="journeyContinue">Continue Journey</button>
            <button class="journey-close" id="journeyClose">Exit Sanctuary</button>
        </div>
    `,document.body.appendChild(e),0),i=["Welcome to your inner sanctuary. Take a deep breath and center yourself. Feel the divine presence surrounding you...","As you breathe deeply, notice the cosmic energies flowing through you. You are connected to the infinite wisdom of the universe...","In this sacred space, allow your mind to quiet. Listen to the subtle whispers of divine guidance...","Feel gratitude for the wisdom that flows to you. You are a vessel of divine understanding...","Carry this sacred energy with you as you return to the world. Your wisdom journey continues...","Journey complete. May divine wisdom illuminate your path always."],o=e.querySelector("#journeyStage"),n=e.querySelector("#progressFill"),r=e.querySelector("#journeyContinue"),a=e.querySelector("#journeyClose");r.addEventListener("click",()=>{++t<i.length?(o.innerHTML=`<p>${i[t]}</p>`,n.style.width=t/i.length*100+"%"):(o.innerHTML=`
                <p>${i[t]}</p>
                <div class="journey-completion">
                    <div class="completion-icon">✨</div>
                    <p>Your inner wisdom has been strengthened.</p>
                </div>
            `,r.style.display="none",a.textContent="Return to World")}),a.addEventListener("click",()=>{e.remove(),showWisdomMessage("Inner journey complete. Wisdom increased.","success")})}function showWisdomMessage(e,t="info"){document.querySelectorAll(".wisdom-message").forEach(e=>e.remove());let i=document.createElement("div");i.className="wisdom-message "+t,i.textContent=e;e={success:"#50C878",error:"#DC143C",info:"#4169E1",warning:"#FFD700"};i.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(0,0,0,0.9);
        color: ${e[t]};
        border: 2px solid ${e[t]};
        padding: 15px 20px;
        border-radius: 10px;
        z-index: 10000;
        font-family: 'Cinzel', serif;
        animation: messageSlideIn 0.5s ease-out;
    `,document.body.appendChild(i),setTimeout(()=>{i.style.animation="messageSlideOut 0.5s ease-in",setTimeout(()=>i.remove(),500)},5e3)}document.addEventListener("DOMContentLoaded",function(){initBookPreview(),initLibraryEnhancements(),initEnhancedLibraryFeatures(),initWisdomPortal()});let messageAnimations=`
    @keyframes messageSlideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }

    @keyframes messageSlideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`,journeyModalStyles=`
    .journey-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10001;
    }

    .journey-content {
        background: var(--shadow-deep);
        border: 3px solid var(--divine-gold);
        border-radius: 20px;
        padding: 40px;
        max-width: 600px;
        text-align: center;
        box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
    }

    .journey-content h2 {
        color: var(--divine-gold);
        font-family: 'Cinzel', serif;
        margin-bottom: 30px;
    }

    .journey-stage p {
        font-size: 1.2rem;
        line-height: 1.6;
        color: var(--star-white);
        margin-bottom: 20px;
    }

    .journey-progress {
        margin: 30px 0;
    }

    .progress-bar {
        width: 100%;
        height: 10px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 5px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--divine-gold), var(--sacred-purple));
        width: 0%;
        transition: width 1s ease;
    }

    .journey-continue, .journey-close {
        background: linear-gradient(45deg, var(--divine-gold), var(--sacred-purple));
        border: none;
        border-radius: 10px;
        padding: 12px 24px;
        color: var(--shadow-deep);
        font-family: 'Cinzel', serif;
        font-weight: 600;
        cursor: pointer;
        margin: 10px;
        transition: all 0.3s ease;
    }

    .journey-continue:hover, .journey-close:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
    }

    .completion-icon {
        font-size: 3rem;
        margin: 20px 0;
    }
`,wisdomMapStyles=`
    .wisdom-map-result {
        margin-top: 20px;
        padding: 20px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 15px;
        border: 2px solid var(--emerald-wisdom);
    }

    .wisdom-map-result h3 {
        color: var(--emerald-wisdom);
        font-family: 'Cinzel', serif;
        text-align: center;
        margin-bottom: 20px;
    }

    .wisdom-paths {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .wisdom-path {
        background: rgba(0, 0, 0, 0.5);
        border: 2px solid rgba(80, 200, 120, 0.3);
        border-radius: 10px;
        padding: 15px;
        opacity: 0.6;
        transition: all 0.3s ease;
    }

    .wisdom-path.active {
        opacity: 1;
        border-color: var(--emerald-wisdom);
        box-shadow: 0 0 20px rgba(80, 200, 120, 0.3);
    }

    .path-icon {
        font-size: 2rem;
        text-align: center;
        margin-bottom: 10px;
    }

    .path-content h4 {
        color: var(--emerald-wisdom);
        font-family: 'Cinzel', serif;
        margin-bottom: 8px;
    }

    .path-content p {
        color: var(--mystic-silver);
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .map-insight {
        text-align: center;
        color: var(--divine-gold);
        font-style: italic;
        font-size: 1.1rem;
    }
`;